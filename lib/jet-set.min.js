const t=Object,s=t=>"function"==typeof t?t():t,e=()=>t.create({snapshot:{},watchers:{},onChange(t,e){const{watchers:n}=this;n[t]=n[t]||[],n[t].push(e),this.snapshot[t]=s(this[t])},offChange(t,s){const{watchers:e}=this;e[t]=e[t].filter(t=>t!==s)}});module.exports=(n=>{let o=e();return t.assign(o,n),new Proxy(o,{set(t,e,n){let{watchers:o,snapshot:h}=t;t[e]=n;for(let e in o){const n=h[e],r=s(t[e]),a=o[e];r!==n&&(a.map(t=>t(r,n)),h[e]=r)}return!0},get:(t,e)=>t.hasOwnProperty(e)?s(t[e]):t[e]})});